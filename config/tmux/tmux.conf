unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# avoid creating a new session by typing in `tmux`
set -g default-client-command list-sessions

set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",ghostty:Tc"
set -ga terminal-overrides ",xterm-ghostty:Tc"
set -ga terminal-overrides ",xterm-256color:Tc"
set -sa terminal-features ",*:256"
set -sa terminal-features ",*:clipboard"
set -sa terminal-features ",*:focus"
set -sa terminal-features ",*:hyperlinks"
set -sa terminal-features ",*:mouse"
set -sa terminal-features ",*:RGB"
set -sa terminal-features ",*:sixel"
set -sa terminal-features ",*:title"
set -sa terminal-features ",*:usstyle"
# Undercurl
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

set -g mode-keys vi
set -g set-clipboard on
set -g allow-passthrough all
set -g mouse on
set -g history-limit 5000
set -g base-index 1
setw -g pane-base-index 1
setw -g automatic-rename off
set -g renumber-windows on
set -g allow-set-title on
set -g set-titles on
set -g set-titles-string "#{session_name}:#{window_index} | #T"
set -g detach-on-destroy off
# Activity monitoring
setw -g monitor-activity off
set -g visual-activity off
set -g visual-bell off
set -g bell-action other
# address vim mode switching delay (http://superuser.com/a/252717/65504)
set -s escape-time 0
set -g display-time 1000
set -g status-interval 1
set -g focus-events on
setw -g aggressive-resize on

unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display 'tmux.conf reloaded';
unbind -T copy-mode-vi MouseDragEnd1Pane
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection-no-clear
bind-key -T copy-mode-vi 'y' send-keys -X copy-pipe
bind | split-window -h
bind - split-window -v
bind > swap-window -t +1 \; next-window
bind < swap-window -t -1 \; previous-window
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R
bind . swap-pane -D
bind , swap-pane -U
bind -r H resize-pane -L 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 2
# kill pane/window without confirmation
bind-key x kill-pane
bind-key & kill-window
bind C-p previous-window
bind C-n next-window
bind-key "S" run-shell "sesh connect \"$(
  sesh list --icons | fzf-tmux -p 80%,70% \
    --no-sort --ansi --border-label ' sesh ' --prompt 'âš¡  ' \
    --header '  ^a all ^t tmux ^g configs ^x zoxide ^d tmux kill ^f find' \
    --bind 'tab:down,btab:up' \
    --bind 'ctrl-a:change-prompt(âš¡  )+reload(sesh list --icons)' \
    --bind 'ctrl-t:change-prompt(ðŸªŸ  )+reload(sesh list -t --icons)' \
    --bind 'ctrl-g:change-prompt(âš™ï¸  )+reload(sesh list -c --icons)' \
    --bind 'ctrl-x:change-prompt(ðŸ“  )+reload(sesh list -z --icons)' \
    --bind 'ctrl-f:change-prompt(ðŸ”Ž  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(âš¡  )+reload(sesh list --icons)' \
    --preview-window 'right:55%' \
    --preview 'sesh preview {}'
)\""

# Gruvbox material colors
set -g popup-border-lines heavy
set -g popup-style "bg=#282828,fg=#ebdbb2"
set -g popup-border-style "fg=#ebdbb2"
set -g status-position top
set -g status on
set -g status-justify left
set -g status-style "bg=#ebdbb2,fg=#1d2021"
set -g status-left-length 100
set -g status-left "#{?client_prefix,#[bg=#d3869b],#[bg=#d8a657]}#[fg=#282828,bold] #S #[bg=#282828] "
set -g status-right-length 400
set -g status-right "#[align=absolute-centre,fg=#1d2021,bold]#(~/.config/tmux/shorten-path '#{pane_current_path}')"
# set -g status-right "#[align=absolute-centre,fg=#1d2021,bold]#{?#{==:#T,#H},,#T @ }#(~/.config/tmux/shorten-path '#{pane_current_path}') #[align=right]"
set -g window-status-format "#[fg=#3c3836,bg=#928374] #I:#W "
set -g window-status-current-format "#[bg=#ebdbb2,fg=#1d2021,bold] #I:#W "
set -g window-status-separator ""
set -g pane-border-style "fg=#282828"
set -g pane-active-border-style "fg=#ebdbb2"
set -g pane-border-status top
set -g pane-border-indicators both
set -g pane-border-lines simple
set -g pane-border-format ''
set -g message-style "bg=#282828,fg=#ebdbb2"

# plugins; cloned and updated manually as of now
set -g @extrakto_popup_position 'R,S'
set -g @extrakto_popup_size '40%'
set -g @@extrakto_grab_area 'recent'
run '~/.config/tmux/plugins/extrakto/extrakto.tmux'

run '~/.config/tmux/plugins/tmux-fzf/main.tmux'
TMUX_FZF_ORDER="window|pane|session|command|keybinding"

set -g @easymotion-s2 's'
set -g @easymotion-use-curses true
run '~/.config/tmux/plugins/tmux-easymotion/easymotion.tmux'

set -g @resurrect-capture-pane-contents 'on'
# dangerous but needed as long as I continue using zinit shims instead of direct
# binaries. Eg. `nvim foo` actually runs `zsh $ZINIT_BIN_PATH/nvim foo` which
# throws off the resurrect save script.
set -g @resurrect-processes ':all:'
set -g @continuum-save-interval '5'
set -g @continuum-restore 'on'
run '~/.config/tmux/plugins/tmux-resurrect/resurrect.tmux'
run-shell '~/.config/tmux/plugins/tmux-continuum/continuum.tmux'
